<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ review.title }} - í›„ê¸° ìƒì„¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
    </style>
</head>

<body class="bg-white max-w-[400px] mx-auto shadow-lg min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white sticky top-0 z-50">
        <!-- Brand Bar -->
        <div class="flex items-center justify-between px-4 pt-2 pb-1">
            <div class="flex items-center">
                <img src="{{ url_for('static', filename='images/ts_logo_brand.png') }}" alt="íŠ¸ë¦½ìŠ¤í† ì–´"
                    class="h-12 object-contain cursor-pointer" onclick="location.href='/'">
            </div>
            <div class="flex items-center space-x-2.5 text-gray-700">
                <button class="hover:text-black transition-colors" onclick="location.href='/'"><i
                        class="fa-solid fa-house text-xl"></i></button>
                <button class="hover:text-black transition-colors"><i
                        class="fa-solid fa-share-nodes text-xl"></i></button>
            </div>
        </div>

        <!-- Category Tabs -->
        <div class="flex items-end px-4 border-b border-gray-100 overflow-x-auto hide-scrollbar bg-white">
            <button class="px-2 py-3 text-gray-400 font-bold whitespace-nowrap text-[15px]">ì „ì²´</button>
            <button class="px-2 py-3 text-gray-400 font-bold whitespace-nowrap text-[15px]">ì¼ë³¸</button>
            <button class="px-2 py-3 text-gray-400 font-bold whitespace-nowrap text-[15px]">ë™ë‚¨ì•„</button>
            <button class="px-2 py-3 text-gray-400 font-bold whitespace-nowrap text-[15px]">ëŒ€ë§Œ/í™ì½©/ì¤‘êµ­</button>
            <div class="relative px-2 py-3">
                <span class="text-gray-900 font-bold whitespace-nowrap text-[15px]">ì—¬í–‰ í›„ê¸°</span>
                <div class="absolute bottom-0 left-0 w-full h-[3px] bg-gray-900"></div>
            </div>
        </div>
    </header>

    <main class="flex-1 pb-10">
        <!-- Breadcrumbs -->
        <div class="px-4 py-3 text-xs text-gray-500">
            í›„ê¸° í™ˆ > ë™ë‚¨ì•„ > ë² íŠ¸ë‚¨ > <span class="text-gray-900 font-medium border-b border-gray-900">ë‹¤ë‚­Â·í˜¸ì´ì•ˆ</span>
        </div>

        <!-- Review Title -->
        <h2 class="px-4 font-bold text-lg text-gray-900 leading-snug mb-3">
            {{ review.title }}
        </h2>

        <!-- Author Info -->
        <div class="px-4 flex items-center justify-between mb-4">
            <div class="flex items-center space-x-2">
                <img src="{{ review.author_avatar }}" class="w-8 h-8 rounded-full bg-gray-200 object-cover"
                    onerror="this.onerror=null; this.src='https://picsum.photos/seed/default/100/100'">
                <span class="text-sm font-bold text-gray-900">{{ review.author }}</span>
            </div>
            <span class="text-xs text-gray-500">{{ review.date }}</span>
        </div>

        <!-- Main Image Area -->
        <!-- Main Image Area -->
        {% if review.images %}
        <div class="relative w-full mb-4">
            <div id="imageSlider" class="flex overflow-x-auto snap-x snap-mandatory hide-scrollbar w-full aspect-[4/3]">
                {% for img in review.images %}
                <img src="{{ img }}" class="w-full h-full flex-shrink-0 object-contain snap-center bg-gray-200"
                    onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1528127269322-539801943592?w=800&q=80'">
                {% endfor %}
            </div>

            {% if review.images|length > 1 %}
            <div
                class="absolute bottom-[10px] right-4 bg-black/60 backdrop-blur-sm text-white text-xs px-3 py-1 rounded-full font-medium z-10">
                <span id="currentImageIndex">1</span> / {{ review.images|length }}
            </div>

            <!-- Dots Indicator -->
            <div class="absolute bottom-[10px] left-1/2 transform -translate-x-1/2 flex space-x-1.5 z-10"
                id="sliderDots">
                {% for i in range(review.images|length) %}
                <div
                    class="w-1.5 h-1.5 rounded-full transition-colors {{ 'bg-white' if loop.index0 == 0 else 'bg-white/50' }}">
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Rating Box -->
        <div class="mx-4 border border-gray-200 rounded-lg p-4 flex justify-between text-center mb-6">
            <div class="flex flex-col items-center justify-center border-r border-gray-100 flex-1">
                <span class="text-xs text-gray-500 mb-1">ì´ì </span>
                <div class="flex items-center text-yellow-400 font-bold">
                    <i class="fas fa-star mr-1"></i>
                    <span class="text-gray-900 text-lg">{{ review.rating }}</span>
                </div>
            </div>
            <div class="flex flex-col items-center justify-center flex-1">
                <span class="text-xs text-gray-500 mb-1">ìˆ™ì†Œ</span>
                <span class="text-gray-900 font-bold">{{ review.rating_detail.accommodation }}</span>
            </div>
            <div class="flex flex-col items-center justify-center flex-1">
                <span class="text-xs text-gray-500 mb-1">ì‹ì‚¬</span>
                <span class="text-gray-900 font-bold">{{ review.rating_detail.food }}</span>
            </div>
            <div class="flex flex-col items-center justify-center flex-1">
                <span class="text-xs text-gray-500 mb-1">ê°€ì´ë“œ</span>
                <span class="text-gray-900 font-bold">{{ review.rating_detail.guide }}</span>
            </div>
        </div>

        <!-- Content -->
        <div class="px-4 text-gray-800 text-sm leading-relaxed whitespace-pre-line mb-8">{{ review.content_full }}</div>

        <!-- Helpful Button -->
        <div class="flex flex-col items-center mb-10">
            <button
                class="flex items-center space-x-2 border border-gray-300 rounded px-4 py-2 text-sm text-gray-700 font-medium hover:bg-gray-50">
                <i class="far fa-thumbs-up"></i>
                <span>ë„ì›€ì´ ë¼ìš”</span>
                <span class="border-l border-gray-300 pl-2 ml-1 text-gray-500">{{ review.likes }}ëª…ì—ê²Œ ë„ì›€ì´ ëì–´ìš”</span>
            </button>
        </div>

        <hr class="border-t-8 border-gray-100 mb-8">

        <!-- Product Info -->
        <div class="px-4 mb-4">
            <h3 class="font-bold text-lg text-gray-900 mb-1">ì´ í›„ê¸°ì˜ ìƒí’ˆ</h3>
            {% if not is_sold_out %}
            <p class="text-xs text-gray-400 mb-4 leading-normal">
                ì´ í›„ê¸°ì˜ ì‘ì„±ìê°€ ì‹¤ì œë¡œ ì˜ˆì•½í•˜ê³  ë‹¤ë…€ì˜¨ ìƒí’ˆì´ì—ìš”. ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•´ ë³´ì„¸ìš”!
            </p>
            {% endif %}

            {% if is_sold_out %}
            <div
                class="flex flex-col items-center justify-center py-10 bg-white border border-gray-100 rounded-xl shadow-sm px-6 text-center">
                <div class="text-4xl mb-6">ğŸ˜¥</div>
                <h4 class="text-lg font-bold text-gray-900 mb-2">ì´ í›„ê¸°ì˜ ìƒí’ˆì€ ë§ˆê°ë˜ì—ˆì–´ìš”.</h4>
                <p class="text-sm text-gray-600 mb-8">ë¹„ìŠ·í•œ ìƒí’ˆì„ ë³´ì‹œê² ì–´ìš”?</p>
                <button onclick="location.href='/'"
                    class="w-full py-3 border border-gray-200 rounded-xl text-gray-900 text-sm font-bold hover:bg-gray-50 transition-colors">
                    ë¹„ìŠ·í•œ ë‹¤ë‚­ ì—¬í–‰ ë³´ê¸°
                </button>
            </div>
            {% else %}
            <div class="border border-gray-200 rounded-lg overflow-hidden relative">
                <div class="relative h-40">
                    <img src="{{ review.product_image }}" class="w-full h-full object-cover"
                        onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1528127269322-539801943592?w=800&q=80'">
                </div>
                <div
                    class="p-4 flex items-center justify-between bg-white hover:bg-gray-50 transition-colors cursor-pointer">
                    <div class="flex-1 pr-4">
                        <h4 class="font-bold text-gray-900 text-sm truncate mb-1">{{ review.product_name }}</h4>
                        <div class="text-xs text-gray-500 mb-1">
                            {{ review.product_city }} Â· {{ review.product_type }} Â· {{ review.product_duration }} Â· {{
                            review.product_departure }}
                        </div>
                        <div class="text-sm font-bold text-gray-900">
                            {{ review.price }} ë¶€í„°~
                        </div>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300"></i>
                </div>
            </div>
            {% endif %}
        </div>

        <hr class="border-t-8 border-gray-100 my-8">

        <!-- Related Reviews (This Product) -->
        <div class="px-4 mb-8">
            <h3 class="font-bold text-lg text-gray-900 mb-4">ì´ ìƒí’ˆì˜ ë‹¤ë¥¸ í›„ê¸°</h3>

            <div class="space-y-4">
                {% for related in related_reviews[:3] %}
                <div class="border border-gray-200 rounded-lg p-4 cursor-pointer hover:border-gray-300 transition-colors"
                    onclick="location.href='/detail/{{ related.id }}'">
                    <!-- Departure & Price -->
                    <div class="text-[11px] text-gray-500 mb-2">
                        {{ related.departure_date }} ì¶œë°œ | {{ related.price }}
                    </div>

                    <!-- Images -->
                    {% if related.images %}
                    <div class="flex gap-2 mb-3">
                        {% for img in related.images[:3] %}
                        <img src="{{ img }}" class="w-16 h-16 object-cover rounded-lg bg-gray-100"
                            onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1528127269322-539801943592?w=200&q=20'">
                        {% endfor %}
                        {% if related.images|length > 3 %}
                        <div
                            class="w-16 h-16 bg-gray-50 rounded-lg flex items-center justify-center text-xs text-gray-500 font-medium">
                            +{{ related.images|length - 3 }}
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Rating & Tags -->
                    <div class="flex items-center space-x-2 mb-2 overflow-hidden">
                        <div class="flex items-center text-yellow-400 text-xs shrink-0">
                            <i class="fas fa-star"></i>
                            <span class="text-gray-900 font-bold ml-1">{{ related.rating }}</span>
                        </div>
                        <div class="flex-1 flex items-center gap-1 overflow-hidden whitespace-nowrap">
                            {% for tag in related.tags %}
                            <span
                                class="px-1.5 py-0.5 bg-gray-100 text-gray-500 text-[10px] rounded truncate min-w-0">{{
                                tag }}</span>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Content -->
                    <p class="text-sm text-gray-600 line-clamp-3 leading-relaxed mb-3">{{ related.content_preview }}
                        <span class="text-gray-400 underline ml-1">ë”ë³´ê¸°</span>
                    </p>

                    <!-- Footer: Author & Date -->
                    <div class="flex justify-between items-center border-t border-gray-50 pt-3">
                        <div class="flex items-center space-x-2 text-xs">
                            <span class="font-bold text-gray-900">{{ related.author }}</span>
                        </div>
                        <div class="text-gray-400 text-xs">
                            <i class="far fa-thumbs-up mr-1"></i> {{ related.likes }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            {% if related_reviews|length > 3 %}
            <button
                class="w-full py-3 mt-4 border border-gray-200 rounded text-sm text-gray-600 font-bold hover:bg-gray-50">
                ì´ ìƒí’ˆ í›„ê¸° ë”ë³´ê¸°
            </button>
            {% endif %}
        </div>

        <hr class="border-t-8 border-gray-100 my-8">

        <!-- Other Reviews of the Region (Prev/Next) -->
        <div class="px-4">
            <h3 class="font-bold text-lg text-gray-900 mb-4">ë‹¤ë‚­Â·í˜¸ì´ì•ˆì˜ ë‹¤ë¥¸í›„ê¸°ë“¤</h3>
            <div class="space-y-4">
                {% for other in [prev_review, next_review] %}
                {% if other %}
                <div class="border border-gray-200 rounded-lg p-4 cursor-pointer hover:border-gray-300 transition-colors"
                    onclick="location.href='/detail/{{ other.id }}'">
                    <h3 class="font-bold text-gray-900 text-sm leading-snug mb-1">
                        {{ other.title }}
                    </h3>
                    <div class="text-[11px] text-gray-500 mb-3">
                        {{ other.departure_date }} ì¶œë°œ | {{ other.price }}
                    </div>

                    {% if other.images %}
                    <div class="flex gap-2 mb-3">
                        {% for img in other.images[:3] %}
                        <div class="relative w-1/3 aspect-square rounded-lg overflow-hidden bg-gray-200">
                            <img src="{{ img }}" alt="Review Image" class="w-full h-full object-cover"
                                onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1528127269322-539801943592?w=400&q=40'">
                            {% if loop.index == 3 and other.images|length > 3 %}
                            <div class="absolute inset-0 bg-black/40 flex items-center justify-center">
                                <span class="text-white text-base font-bold">+{{ other.images|length - 3 }}</span>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <div class="flex items-center space-x-2 mb-3 overflow-hidden">
                        <div class="flex items-center text-yellow-400 text-xs shrink-0">
                            <i class="fas fa-star"></i>
                            <span class="text-gray-800 font-bold ml-1">{{ other.rating }}</span>
                        </div>
                        <div class="flex-1 flex items-center gap-1 overflow-hidden whitespace-nowrap">
                            {% for tag in other.tags %}
                            <span
                                class="px-1.5 py-0.5 bg-gray-100 text-gray-500 text-[10px] rounded truncate min-w-0">{{
                                tag }}</span>
                            {% endfor %}
                        </div>
                    </div>

                    <p class="text-xs text-gray-600 line-clamp-3 leading-relaxed mb-3">{{ other.content_preview }} <span
                            class="text-gray-400 underline ml-1">ë”ë³´ê¸°</span></p>

                    <div class="flex justify-between items-center pt-2 border-t border-gray-100">
                        <div class="items-center text-gray-500 text-[10px] flex">
                            <i class="far fa-thumbs-up mr-1"></i> {{ other.likes }}
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- Go to List Button -->
        <div class="px-4 mt-8 pb-10">
            <button onclick="location.href='/'"
                class="w-full py-4 bg-gray-900 text-white font-bold rounded-lg text-sm transition-colors hover:bg-black">
                í›„ê¸° ëª©ë¡ìœ¼ë¡œ ì´ë™
            </button>
        </div>
    </main>

    <script>
        const slider = document.getElementById('imageSlider');
        if (slider) {
            slider.addEventListener('scroll', () => {
                const index = Math.round(slider.scrollLeft / slider.offsetWidth);

                // Update Numeric Counter
                const counter = document.getElementById('currentImageIndex');
                if (counter) counter.innerText = index + 1;

                // Update Dots
                const dots = document.getElementById('sliderDots');
                if (dots) {
                    Array.from(dots.children).forEach((dot, i) => {
                        if (i === index) {
                            dot.classList.remove('bg-white/50');
                            dot.classList.add('bg-white');
                        } else {
                            dot.classList.remove('bg-white');
                            dot.classList.add('bg-white/50');
                        }
                    });
                }
            });
        }
    </script>
</body>

</html>